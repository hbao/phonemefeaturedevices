<?xml version="1.0" encoding="UTF-8"?>
<!--  called from build.xml to build for WinCE -->
<project name="phoneme_featre_wince">


	<description>
        An Ant script to build the phoneme_feature WinCE targets.
    </description>

	<property environment="env" />
	
	<path id="svnant.classpath">
		<fileset dir="${env.BLUEWHALE_JAVA}/svnant-1.1.0-RC2/lib">
			<include name="*.jar" />
		</fileset>
	</path>
	<typedef resource="org/tigris/subversion/svnant/svnantlib.xml" classpathref="svnant.classpath" />
	
	<target name="vm_wm5ppc_arm" description="Windows Mobile 5 PocketPC SDK - ARM">

		<echo>---------------------------------------------------</echo>
		<echo>Windows Mobile 5 PocketPC - ARM - eVC++ 4.0</echo>
		<echo>---------------------------------------------------</echo>
	
		<!-- Be nice and ensure external dependencies were built successfully early in the process -->
		<property name="finalExpectedOutputFile" value="C:\wince_vm\wm5_ppc\midp\bin\arm\runMidlet.exe" />

		<delete includeEmptyDirs="true" quiet="true">
			<fileset file="${finalExpectedOutputFile}" />
		</delete>

		<property name="platform" value="wince" />
		<property name="arch" value="arm" />
		<property name="release" value="release" />

		<property name="deviceSDK" value="Windows Mobile 5 PocketPC" />
		
		<property name="executionDirectory" value="${basedir}/wince_arm_evc4/wm5_ppc" />
		<property name="HOME" value="${basedir}" />
		
		<antcall target="build_pcsl_wince" />
		<antcall target="build_cldc_wince" />
		<antcall target="build_midp_wince" />
		<antcall target="build_cab" />

		<available file="${finalExpectedOutputFile}" property="finalexe.present" />
		<fail unless="finalexe.present" message="runMidlet.exe NOT produced: ${finalExpectedOutputFile} -- check to see if earlier build steps failed." />

	</target>	
	
	
	<target name="vm_wm2003ppc_arm" description="Windows Mobile 2003 PocketPC SDK - ARM">

		<echo>---------------------------------------------------</echo>
		<echo>Windows Mobile 2003 PocketPC - ARM - eVC++ 4.0</echo>
		<echo>---------------------------------------------------</echo>

		<svn javasvn="no">
			<info target="https://svn1.hosted-projects.com/bluewhalesystems/mail/trunk" />
		</svn>
		<property name ="src.revision" value="${svn.info.rev}" />

		<!-- Be nice and ensure external dependencies were built successfully early in the process -->
		<property name="finalExpectedOutputFile" value="C:\wince_vm\wm2003_ppc\midp\bin\arm\runMidlet.exe" />

		<delete includeEmptyDirs="true" quiet="true">
			<fileset file="${finalExpectedOutputFile}" />
		</delete>

		<property name="platform" value="wince" />
		<property name="arch" value="arm" />
		<property name="release" value="release" />

		<property name="deviceSDK" value="Windows Mobile 2003 PocketPC" />
		
		<property name="executionDirectory" value="${basedir}/wince_arm_evc4/wm2003_ppc" />
		<property name="HOME" value="${basedir}" />
		
		<antcall target="build_pcsl_wince" />
		<antcall target="build_cldc_wince" />
		<antcall target="build_midp_wince" />
		<antcall target="build_cab" />

		<available file="${finalExpectedOutputFile}" property="finalexe.present" />
		<fail unless="finalexe.present" message="runMidlet.exe NOT produced: ${finalExpectedOutputFile} -- check to see if earlier build steps failed." />

	</target>	
	
	
	
	<target name="build_pcsl_wince">
		<echo>--- Build PCSL ---</echo>
		<property name="dos_command" value="call ant_run_sh.bat build-pcsl.sh" />
		<antcall target="dos_exec" />
	</target>


	<target name="build_cldc_wince">
		<echo>--- Build CLDC ---</echo>
		<property name="dos_command" value="call ant_run_sh.bat build-cldc.sh wm2003ppcarm_v${src.revision}" />
		<antcall target="dos_exec" />
	</target>


	<target name="build_midp_wince">
		<echo>--- Build MIDP ---</echo>
		<property name="dos_command" value="call ant_run_sh.bat build-midp.sh" />
		<antcall target="dos_exec" />
	</target>


	<target name="build_cab">
		<echo>--- Build CAB ---</echo>
		<property name="dos_command" value="call ant_run_sh.bat build-cab.sh v${src.revision}" />
		<antcall target="dos_exec" />
	</target>


	<target name="dos_exec" description="Execute a DOS command">
		<echo>dos_command[${dos_command}]    properties: [${deviceSDK}]    platform: [${platform}]   release: [${release}]   executionDirectory[${executionDirectory}]</echo>
		<exec executable="cmd" dir="${executionDirectory}" failonerror="true">
			<arg value="/c" />
			<arg value="${dos_command}" />
		</exec>
	</target>	
	
	
</project>

